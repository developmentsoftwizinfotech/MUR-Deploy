<nb-card class="px-2">
    <nb-card-header class="row align-items-center justify-content-between">
      <div class="col-md-6 text-start">
        <h5 style="font-weight: 600">Vendor MIS Summary</h5>
      </div>
  
      <div class="col-md-6 pr-0 row p-0 m-0 justify-content-center align-items-center">
        <div class="col-4 p-1">
          <ng-select class="dropdown-top" [(ngModel)]="analysisType" class="fixed-dropdown-size" (change)="getFormValue()"
            [appendTo]="'body'" placeholder="Select Status" fullWidth fieldSize="medium" [clearable]="false">
            <ng-option value="MTD">Monthly Analysis</ng-option>
            <ng-option value="QTD">Quaterly Analysis</ng-option>
          </ng-select>
        </div>
        <form [formGroup]="nbForm" class="ml-1 row col-8 p-1">
          <div class="p-1 col-6">
            <p-calendar formControlName="YearDate" view="year" (ngModelChange)="getFormValue()" dateFormat="yy"
              placeholder="Select Year" [readonlyInput]="true"></p-calendar>
            <!-- <nb-calendar [(date)]="date" [boundingMonth]="true"></nb-calendar> -->
          </div>
          <div class="p-1 col-6">
            <ng-select class="dropdown-top col" class="fixed-dropdown-size" [clearable]="false" formControlName="EquipmentCategoryId"  (change)="getFormValue()"
            [appendTo]="'body'" placeholder="Select Cost Head" fullWidth fieldSize="medium">
            <ng-option *ngFor="let option of costHeading?.EquipmentCategoryList" [value]="option.EquipmentCategoryId">{{ option.EquipmentCategoryName}}</ng-option>
          </ng-select>
          </div>

        </form>
      </div>
    </nb-card-header>
  </nb-card>
  
  <nb-card >
    <nb-card-body class="mb-4">
      <div class="row justify-content-between">
        <div class="col-12">
          <div class="row justify-content-between align-content-center">
            <h6 class="my-3 col-6" style="font-weight: 600">
              MTD Analysis Monthly ({{ viewListTable === "amount" ? "$" : "%" }})
            </h6>
            <div class="my-3 col-6" style="font-weight: 600">
              <nb-radio-group class="d-flex justify-content-end"   (ngModelChange)="changeToGraph($event)" [(ngModel)]="viewListTable">
                <nb-radio *ngFor="let option of options"  [value]="option.value">
                  {{ option.label }}
                </nb-radio>
              </nb-radio-group>
            </div>
          </div>
          <p-table  *ngIf="analysisDetails" class="p-datatable p-component p-datatable-sm" #dt1 [value]="monthlyAnalysis?.AnualBudget"
            dataKey="CleaningType" [showCurrentPageReport]="true"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
            [globalFilterFields]="['CleaningType']" [tableStyle]="{ 'min-width': '40rem' }" [columns]="cols">
            <ng-template pTemplate="header" style="border-bottom: none; border: 2px solid" let-columns>
              <tr>
                <th rowspan="2">{{monthlyAnalysis?.EquipmentCategoryName}}</th>
                <th rowspan="2">{{ monthlyAnalysis?.Year }}-Budget</th>
                <th colspan="12" class="text-center">
                  {{
                  monthlyAnalysis?.MonthlySummaries
                  ? "Monthly - Actual "
                  : "Quarterly - Actual"
                  }}
                  {{ viewListTable === "amount" ? "$" : "%" }}
                </th>
              </tr>
              <tr>
                <ng-container *ngFor="let item of analysisDetails">
                  <th colspan="1" class="text-center">
                    {{ item?.MonthName ? item.MonthName :'Q-' + item?.Quarter}}
                  </th>
                </ng-container>
  
  
                <!-- <th style="width: 2%; color"></th> -->
              </tr>
            </ng-template>
  
            <!-- ... (previous code) ... -->
  
            <ng-template pTemplate="body" let-rowData let-columns="columns">
              <tr>
                <td>{{rowData?.EquipmentName}}</td>
             
                <ng-container>
                  <td>
                    <div [ngClass]="checkListRecord === false ? 'd-none' : ''">
                      ${{ rowData?.Budget }}
                    </div>
  
                    <ngx-skeleton-loader [ngClass]="checkListRecord === true ? 'd-none' : ''" count="1" appearance="line"
                      animation="pulse">
                    </ngx-skeleton-loader>
                  </td>
                </ng-container>
                <ng-container *ngFor="let month of analysisDetails">
                  <ng-container *ngIf="getMonthlyBudget(month, rowData)">
                    
                    <td>
                      <div *ngIf="viewListTable === 'amount'" [ngClass]="checkListRecord === false ? 'd-none' : ''">
                        ${{ getMonthlyBudget(month, rowData)?.CumulativeSum }}
                      </div>
                      <div *ngIf="viewListTable === 'percentage'" [ngClass]="checkListRecord === false ? 'd-none' : ''">
                        {{ getMonthlyBudget(month, rowData)?.CumulativePercentage }}%
                      </div>
                      <ngx-skeleton-loader [ngClass]="checkListRecord === true ? 'd-none' : ''" count="1"
                        appearance="line" animation="pulse">
                      </ngx-skeleton-loader>
                    </td>
                  </ng-container>
                  <ng-container *ngIf="!getMonthlyBudget(month, rowData)">
                    <td colspan="1">$0</td>
                  </ng-container>
                </ng-container>
              </tr>
            </ng-template>
          </p-table>
          <div *ngIf="!analysisDetails" class="p-3 ng-select-container">
            No Record Found....
          </div>
        </div>
      </div>

     
    </nb-card-body>
  </nb-card>
  
  <nb-card *ngIf="analysisDetails" >
    <nb-card-body id="barChart" style="height: 30vh">
      <div class="row justify-content-between align-content-center">
        <h6 class="my-3 col-9" style="font-weight: 600">
          {{monthlyAnalysis?.EquipmentCategoryName}} ({{ viewListTable === "amount" ? "$" : "%" }})
        </h6>
       
      </div>
      <chart type="bar" [data]="data" [options]="chartOptions"></chart>
      <!-- <ngx-chartjs-line></ngx-chartjs-line> -->
    </nb-card-body>
  </nb-card>

