<nb-card class="px-2">
  <nb-card-header class="row align-items-center justify-content-center">
    <div class="col-md-6 text-start">
      <h5 style="font-weight: 600">Graph Analysis ($)</h5>
    </div>
    <div class="col-md-6 text-right">
      <button nbButton status="danger" type="reset" (click)="resetForm()" class="mr-2">Reset</button>
      <button type="button" nbButton status="primary" (click)="searchFilter()" type="button"
        class=" mr-2">Search</button>
    </div>
    <!-- <div class="col-md-12 pr-0 row p-0 m-0 justify-content-end "> -->
    <!-- <div class="col-6 p-1">
            <ng-select class="dropdown-top" [(ngModel)]="analysisType" class="fixed-dropdown-size" (change)="getFormValue()"
              [appendTo]="'body'" placeholder="Select Status" fullWidth fieldSize="medium">
              <ng-option value="MTD">Monthly Analysis</ng-option>
              <ng-option value="QTD">Quaterly Analysis</ng-option>
            </ng-select>
          </div> -->
    <form [formGroup]="nbForm" class="col-md-12 mt-3 row p-0 justify-content-center">
      <div class="col-md-12 mt-3 row p-0 justify-content-center">
        <div class="p-1" class="col-3 p-0 px-1 my-1">

          <ng-select [items]="vesselListDropDown" (change)="selectAll('VesselListIds',vesselListDropDown,'one',7,1)"
            [clearSearchOnAdd]="true" [closeOnSelect]="false" labelForId="state" [multiple]="true"
            placeholder="Select Vessel Name" clearAllText="unselectAll('VesselListIds')" formControlName="VesselListIds"
            [bindLabel]="'VesselName'">
            <ng-template ng-header-tmp>
              <button size="tiny" nbButton (click)="selectAll('VesselListIds',vesselListDropDown,'all',7,1)"
                status="basic" class="btn btn-sm mr-2">Select all</button>
              <button size="tiny" nbButton (click)="unselectAll('VesselListIds')" status="basic"
                class="btn btn-sm ">Unselect all</button>
            </ng-template>
            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="row">
                <input id="item-{{index}}" class="mr-2" type="checkbox" [ngModel]="item$.selected"
                  [ngModelOptions]="{standalone: true}" />
                {{item['VesselName']}}
              </div>
            </ng-template>
            <ng-template ng-multi-label-tmp let-items="items">
              <div class="ng-value" *ngFor="let item of items | slice:0:1">
                {{item['VesselName']}}
              </div>
              <div class="ng-value" *ngIf="items.length > 1">
                <span class="ng-value-label">{{items.length - 1}} more...</span>
              </div>
            </ng-template>
          </ng-select>


        </div>
        <div class="p-1" class="col-3 p-0 px-1 my-1">
          <input nbInput placeholder="Date Range" (keydown)="dateFilter($event, 'commence')" fullWidth
            formControlName="DateCommenceRangeControl" [nbDatepicker]="commencePicker" />
          <nb-rangepicker #commencePicker (rangeChange)="dateFilter($event, 'commence')"></nb-rangepicker>
          <!-- <p-calendar  formControlName="VoyageCommenceDate" view="month" (ngModelChange)="getFormValue()" dateFormat="mm/yy" placeholder="Voyage Commence Date" [readonlyInput]="true"></p-calendar> -->
          <!-- <nb-calendar [(date)]="date" [boundingMonth]="true"></nb-calendar> -->
        </div>

        <div class="p-1" class="col-3 p-0 px-1 my-1">
          <ng-select
            (change)="selectGetAll('FixtureListIds',fixturePortListDropDown?.MurFixtureList,'one','Fixture','MURFixtureNo')"
            [items]="fixturePortListDropDown?.MurFixtureList" [clearSearchOnAdd]="true" [closeOnSelect]="false"
            labelForId="state" [multiple]="true" placeholder="Select MUR Fixture No." clearAllText="Clear"
            formControlName="FixtureListIds" [bindLabel]="'MURFixtureNo'">
            <ng-template ng-header-tmp>
              <button size="tiny" nbButton
                (click)="selectGetAll('FixtureListIds',fixturePortListDropDown?.MurFixtureList,'all','Fixture','MURFixtureNo')"
                status="basic" class="btn btn-sm mr-2">Select all</button>
              <button size="tiny" nbButton (click)="unselectAll('FixtureListIds')" status="basic"
                class="btn btn-sm ">Unselect all</button>
            </ng-template>
            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="row">
                <input id="item-{{index}}" class="mr-2" type="checkbox" [ngModel]="item$.selected"
                  [ngModelOptions]="{standalone: true}" />
                {{item['MURFixtureNo']}}
              </div>
            </ng-template>
            <ng-template ng-multi-label-tmp let-items="items">
              <div class="ng-value" *ngFor="let item of items | slice:0:1">
                {{item['MURFixtureNo']}}
              </div>
              <div class="ng-value" *ngIf="items.length > 1">
                <span class="ng-value-label">{{items.length - 1}} more...</span>
              </div>
            </ng-template>
          </ng-select>
        </div>
        <div class="p-1" class="col-3 p-0 px-1 my-1">
          <ng-select
            (change)="selectGetAll('VendorListIds',vendorandMakerListDropDown?.VendorList,'one','VendorIds','VendorId')"
            [items]="vendorandMakerListDropDown?.VendorList" [clearSearchOnAdd]="true" [closeOnSelect]="false"
            labelForId="state" [multiple]="true" placeholder="Select Vendor Name" clearAllText="Clear"
            formControlName="VendorListIds" [bindLabel]="'VendorName'">
            <ng-template ng-header-tmp>
              <button size="tiny" nbButton
                (click)="selectGetAll('VendorListIds',vendorandMakerListDropDown?.VendorList,'all','VendorIds','VendorId')"
                status="basic" class="btn btn-sm mr-2">Select all</button>
              <button size="tiny" nbButton (click)="unselectAll('VendorListIds')" status="basic"
                class="btn btn-sm ">Unselect all</button>
            </ng-template>
            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="row">
                <input id="item-{{index}}" class="mr-2" type="checkbox" [ngModel]="item$.selected"
                  [ngModelOptions]="{standalone: true}" />
                {{item['VendorName']}}
              </div>
            </ng-template>
            <ng-template ng-multi-label-tmp let-items="items">
              <div class="ng-value" *ngFor="let item of items | slice:0:1">
                {{item['VendorName']}}
              </div>
              <div class="ng-value" *ngIf="items.length > 1">
                <span class="ng-value-label">{{items.length - 1}} more...</span>
              </div>
            </ng-template>
          </ng-select>
        </div>
        <div class="p-1" class="col p-0 px-1 my-1">
          <ng-select
            (change)="selectGetAll('VendorMakerListIds',vendorandMakerListDropDown?.VendorMakerList,'one','VendorMaker','VendorMaker')"
            [items]="vendorandMakerListDropDown?.VendorMakerList" [clearSearchOnAdd]="true" [closeOnSelect]="false"
            labelForId="state" [multiple]="true" placeholder="Select Maker Name" clearAllText="Clear"
            formControlName="VendorMakerListIds" [bindLabel]="'VendorMaker'">
            <ng-template ng-header-tmp>
              <button size="tiny" nbButton
                (click)="selectGetAll('VendorMakerListIds',vendorandMakerListDropDown?.VendorMakerList,'all','VendorMaker','VendorMaker')"
                status="basic" class="btn btn-sm mr-2">Select all</button>
              <button size="tiny" nbButton (click)="unselectAll('VendorMakerListIds')" status="basic"
                class="btn btn-sm ">Unselect all</button>
            </ng-template>
            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="row">
                <input id="item-{{index}}" class="mr-2" type="checkbox" [ngModel]="item$.selected"
                  [ngModelOptions]="{standalone: true}" />
                {{item['VendorMaker']}}
              </div>
            </ng-template>
            <ng-template ng-multi-label-tmp let-items="items">
              <div class="ng-value" *ngFor="let item of items | slice:0:1">
                {{item['VendorMaker']}}
              </div>
              <div class="ng-value" *ngIf="items.length > 1">
                <span class="ng-value-label">{{items.length - 1}} more...</span>
              </div>
            </ng-template>
          </ng-select>
        </div>
        <div class="p-1" class="col-3 p-0 px-1 my-1">
          <ng-select [items]="equipmentListDropDown?.EquipmentCategoryList"
            (change)="selectGetAll('EquipmentCategoryListIds',equipmentListDropDown?.EquipmentCategoryList,'one','EquipmentCategoryIds','EquipmentCategoryId')"
            [clearSearchOnAdd]="true" [closeOnSelect]="false" labelForId="state" [multiple]="true"
            placeholder="Select Category Name" clearAllText="Clear" formControlName="EquipmentCategoryListIds"
            [bindLabel]="'EquipmentCategoryName'">
            <ng-template ng-header-tmp>
              <button size="tiny" nbButton
                (click)="selectGetAll('EquipmentCategoryListIds',equipmentListDropDown?.EquipmentCategoryList,'all','EquipmentCategoryIds','EquipmentCategoryId')"
                status="basic" class="btn btn-sm mr-2">Select all</button>
              <button size="tiny" nbButton (click)="unselectAll('EquipmentCategoryListIds')" status="basic"
                class="btn btn-sm ">Unselect all</button>
            </ng-template>
            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="row">
                <input id="item-{{index}}" class="mr-2" type="checkbox" [ngModel]="item$.selected"
                  [ngModelOptions]="{standalone: true}" />
                {{item['EquipmentCategoryName']}}
              </div>
            </ng-template>
            <ng-template ng-multi-label-tmp let-items="items">
              <div class="ng-value" *ngFor="let item of items | slice:0:1">
                {{item['EquipmentCategoryName']}}
              </div>
              <div class="ng-value" *ngIf="items.length > 1">
                <span class="ng-value-label">{{items.length - 1}} more...</span>
              </div>
            </ng-template>
          </ng-select>
        </div>
        <div class="p-1" class="col p-0 px-1 my-1">
          <ng-select [items]="equipmentListDropDown?.EquipmentList"
            (change)="selectGetAll('EquipmentListIds',equipmentListDropDown?.EquipmentList,'one','EquipmentIds','EquipmentId')"
            [clearSearchOnAdd]="true" [closeOnSelect]="false" labelForId="state" [multiple]="true"
            placeholder="Select Equipment Name" clearAllText="Clear" formControlName="EquipmentListIds"
            [bindLabel]="'EquipmentName'">
            <ng-template ng-header-tmp>
              <button size="tiny" nbButton
                (click)="selectGetAll('EquipmentListIds',equipmentListDropDown?.EquipmentList,'all','EquipmentIds','EquipmentId')"
                status="basic" class="btn btn-sm mr-2">Select all</button>
              <button size="tiny" nbButton (click)="unselectAll('EquipmentListIds')" status="basic"
                class="btn btn-sm ">Unselect all</button>
            </ng-template>
            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="row">
                <input id="item-{{index}}" class="mr-2" type="checkbox" [ngModel]="item$.selected"
                  [ngModelOptions]="{standalone: true}" />
                {{item['EquipmentName']}}
              </div>
            </ng-template>
            <ng-template ng-multi-label-tmp let-items="items">
              <div class="ng-value" *ngFor="let item of items | slice:0:1">
                {{item['EquipmentName']}}
              </div>
              <div class="ng-value" *ngIf="items.length > 1">
                <span class="ng-value-label">{{items.length - 1}} more...</span>
              </div>
            </ng-template>
          </ng-select>
        </div>

        <div class="p-1" class="col p-0 px-1 my-1">
          <ng-select [items]="equipmentListDropDown?.UnitList"
            (change)="selectGetAll('UnitListIds',equipmentListDropDown?.UnitList,'one','UnitIds','UnitId')"
            [clearSearchOnAdd]="true" [closeOnSelect]="false" labelForId="state" [multiple]="true"
            placeholder="Select UOM" clearAllText="Clear" formControlName="UnitListIds" [bindLabel]="'UnitName'">
            <ng-template ng-header-tmp>
              <button size="tiny" nbButton
                (click)="selectGetAll('UnitListIds',equipmentListDropDown?.UnitList,'all','UnitIds','UnitId')"
                status="basic" class="btn btn-sm mr-2">Select all</button>
              <button size="tiny" nbButton (click)="unselectAll('UnitListIds')" status="basic"
                class="btn btn-sm ">Unselect all</button>
            </ng-template>
            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="row">
                <input id="item-{{index}}" class="mr-2" type="checkbox" [ngModel]="item$.selected"
                  [ngModelOptions]="{standalone: true}" />
                {{item['UnitName']}}
              </div>
            </ng-template>
            <ng-template ng-multi-label-tmp let-items="items">
              <div class="ng-value" *ngFor="let item of items | slice:0:1">
                {{item['UnitName']}}
              </div>
              <div class="ng-value" *ngIf="items.length > 1">
                <span class="ng-value-label">{{items.length - 1}} more...</span>
              </div>
            </ng-template>
          </ng-select>
        </div>
        <div class="p-1" class="col p-0 px-1 my-1">
          <ng-select [items]="fixturePortListDropDown?.SupplyPortList"
            (change)="selectGetAll('PortListIds',fixturePortListDropDown?.SupplyPortList,'one','PortIds','PortId')"
            [clearSearchOnAdd]="true" [closeOnSelect]="false" labelForId="state" [multiple]="true"
            placeholder="Select Supply Location" clearAllText="Clear" formControlName="PortListIds"
            [bindLabel]="'PortName'">
            <ng-template ng-header-tmp>
              <button size="tiny" nbButton
                (click)="selectGetAll('PortListIds',fixturePortListDropDown?.SupplyPortList,'all','PortIds','PortId')"
                status="basic" class="btn btn-sm mr-2">Select all</button>
              <button size="tiny" nbButton (click)="unselectAll('PortListIds')" status="basic"
                class="btn btn-sm ">Unselect all</button>
            </ng-template>
            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
              <div class="row">
                <input id="item-{{index}}" class="mr-2" type="checkbox" [ngModel]="item$.selected"
                  [ngModelOptions]="{standalone: true}" />
                {{item['PortName']}}
              </div>
            </ng-template>
            <ng-template ng-multi-label-tmp let-items="items">
              <div class="ng-value" *ngFor="let item of items | slice:0:1">
                {{item['PortName']}}
              </div>
              <div class="ng-value" *ngIf="items.length > 1">
                <span class="ng-value-label">{{items.length - 1}} more...</span>
              </div>
            </ng-template>
          </ng-select>
        </div>


        <!--  -->
      </div>
    </form>
    <!-- </div> -->
  </nb-card-header>
</nb-card>


<nb-card>
  <nb-card-body id="barChart" style="height: 30vh">
    <div class="row justify-content-center align-content-center">
      <h6 class="my-3 col-12 text-center" style="font-weight: 600">
        Product Purchase History ($)
      </h6>

    </div>

    <chart type="bar" [data]="data" [options]="chartOptions"></chart> <br>

  </nb-card-body>
</nb-card>

<nb-card>
  <nb-card-body class="mb-4">
    <div class="row justify-content-between">
      <div class="col-12">
        <div class="row justify-content-between align-content-center">
          <h6 class="my-3 col-6" style="font-weight: 600">
            Graph Analysis ($)
          </h6>
          <div class="my-3 col-6" style="font-weight: 600">
            <!-- <nb-radio-group class="d-flex justify-content-end" [(ngModel)]="viewListTable">
                  <nb-radio *ngFor="let option of options" [value]="option.value">
                    {{ option.label }}
                  </nb-radio>
                </nb-radio-group> -->
          </div>
        </div>
        <div class="row justify-content-between align-content-center">

          <div class=" col-lg-3 col-md-12 mt-md-3">
            <p-table [value]="GraphAnalysis?.VendorDetails" class="p-datatable p-component p-datatable-sm"
              rowGroupMode="rowspan" groupRowsBy="VendorName" sortField="VendorName" sortMode="single"
              [tableStyle]="{'min-width': '20rem'}">
              <ng-template pTemplate="header">
                <tr>
                  <th class="text-start" colspan="2">
                    Total Vendor - {{GraphAnalysis?.TotalVendorCount}}
                    <!-- <p-sortIcon field="ActualSum"></p-sortIcon> -->
                  </th>
                  <th class="text-center" colspan="1">
                    {{GraphAnalysis?.TotalQuantity}}
                    <!-- <p-sortIcon field="Difference"></p-sortIcon> -->
                  </th>
                  <th class="text-center" colspan="1">
                    {{GraphAnalysis?.TotalSumOFAmount}}
                    <!-- <p-sortIcon field="Difference"></p-sortIcon> -->
                  </th>
                  <th colspan="1"></th>
                </tr>
                <tr>
                  <th>Vendor</th>
                  <th>Product</th>
                  <th>QTY</th>
                  <th>Amount</th>
                  <th>Per Unit Price</th>

                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-customer let-rowIndex="rowIndex" let-rowgroup="rowgroup"
                let-rowspan="rowspan">
                <tr>

                  <td *ngIf="rowgroup" [attr.rowspan]="rowspan">
                    {{customer.VendorName}}
                  </td>
                  <td>
                    {{customer.EquipmentName}}
                  </td>
                  <td>
                    {{customer.QtyReceived}}
                  </td>
                  <td>
                    {{customer.SubTotal}}
                  </td>
                  <td>
                    {{customer.CostPerUnit}}
                  </td>


                </tr>
              </ng-template>
            </p-table>

          </div>
          <br>
          <div class=" col-lg-3 col-md-12 mt-md-3">
            <p-table [value]="GraphAnalysis?.VendorCostDetails" class="p-datatable p-component p-datatable-sm"
              rowGroupMode="rowspan" groupRowsBy="VendorName" sortField="VendorName" sortMode="single"
              [tableStyle]="{'min-width': '20rem'}">
              <ng-template pTemplate="header">
                <tr>
                  <th class="text-start" colspan="2">
                    Total Vendor Cost
                    <!-- <p-sortIcon field="ActualSum"></p-sortIcon> -->
                  </th>
                  <th class="text-center" colspan="1">
                    {{GraphAnalysis?.TotalSumOFAmount}}
                    <!-- <p-sortIcon field="Difference"></p-sortIcon> -->
                  </th>


                </tr>
                <tr>
                  <th>Rank</th>
                  <th>Vendor</th>
                  <th>Amount</th>


                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-customer let-rowIndex="rowIndex" let-rowgroup="rowgroup"
                let-rowspan="rowspan">
                <tr>
                  <td>{{rowIndex + 1 }}</td>
                  <td *ngIf="rowgroup" [attr.rowspan]="rowspan">
                    {{customer.VendorName}}
                  </td>
                  <td>
                    {{customer.SubTotal}}
                  </td>



                </tr>
              </ng-template>
            </p-table>

          </div>
          
          <div class=" col-lg-3 col-md-12 mt-md-3">
            <p-table [value]="GraphAnalysis?.VesselDetails" class="p-datatable p-component p-datatable-sm"
              rowGroupMode="rowspan" groupRowsBy="VesselName" sortField="VesselName" sortMode="single"
              [tableStyle]="{'min-width': '20rem'}">
              <ng-template pTemplate="header">
                <tr>
                  <th class="text-center" colspan="3">
                    Total Vessel :  {{GraphAnalysis?.TotalVesselCount}}
                    <!-- <p-sortIcon field="ActualSum"></p-sortIcon> -->
                  </th>
                


                </tr>
                <tr>
                  <th>Vessel Name</th>
                  <th>QTY</th>
                  <th>Amount</th>


                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-customer let-rowIndex="rowIndex" let-rowgroup="rowgroup"
                let-rowspan="rowspan">
                <tr>
                
                  <td *ngIf="rowgroup" [attr.rowspan]="rowspan">
                    {{customer.VesselName}}
                  </td>
                  <td>
                    {{customer.QtyReceived}}
                  </td>
                  <td>
                    {{customer.SubTotal}}
                  </td>



                </tr>
              </ng-template>
            </p-table>

          </div>
          <div class=" col-lg-3 col-md-12 mt-md-3">
            <p-table [value]="GraphAnalysis?.EquipmentDetails" class="p-datatable p-component p-datatable-sm"
              rowGroupMode="rowspan" groupRowsBy="EquipmentName" sortField="EquipmentName" sortMode="single"
              [tableStyle]="{'min-width': '20rem'}">
              <ng-template pTemplate="header">
                <tr>
                  <th class="text-start" colspan="1">
                    Total Product - {{GraphAnalysis?.TotalEquipmentCount}}
                    <!-- <p-sortIcon field="ActualSum"></p-sortIcon> -->
                  </th>
                  <th class="text-center" colspan="1">
                    {{GraphAnalysis?.TotalQuantity}}
                    <!-- <p-sortIcon field="Difference"></p-sortIcon> -->
                  </th>
                  <th class="text-center" colspan="1">
                    {{GraphAnalysis?.TotalSumOFAmount}}
                    <!-- <p-sortIcon field="Difference"></p-sortIcon> -->
                  </th>


                </tr>
                <tr>
                  <th>Product</th>
                  <th>QTY</th>
                  <th>Amount</th>


                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-customer let-rowIndex="rowIndex" let-rowgroup="rowgroup"
                let-rowspan="rowspan">
                <tr>
                  
                  <td *ngIf="rowgroup" [attr.rowspan]="rowspan">
                    {{customer.EquipmentName}}
                  </td>
                  <td>
                    {{customer.QtyReceived}}
                  </td>
                  <td>
                    {{customer.SubTotal}}
                  </td>



                </tr>
              </ng-template>
            </p-table>

          </div>
        </div>
      </div>
    </div>
  </nb-card-body>
</nb-card>